<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tournoi Suisse + Bracket √âliminatoire</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1, h2 {
    color: #70c1b3;
  }
  .section {
    margin-bottom: 40px;
  }
  .round {
    background: #222;
    padding: 12px;
    border-radius: 8px;
    margin: 8px 0;
  }
  .anime {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 6px;
    margin: 4px 8px 4px 0;
    background: #444;
  }
  .qualified {
    background: #4caf50;
    color: #fff;
  }
  .eliminated {
    background: #b71c1c;
    color: #fff;
    text-decoration: line-through;
  }
  .match-winner {
    color: #70c1b3;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Simulation Tournoi Suisse + Bracket √âliminatoire</h1>

<div id="output" class="section"></div>

<script>
(() => {
  const animeNames = Array.from({ length: 16 }, (_, i) => `A${i + 1}`);

  class Anime {
    constructor(name) {
      this.name = name;
      this.wins = 0;
      this.losses = 0;
      this.eliminated = false;
      this.qualified = false;
    }
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function simulateSwiss(animeList) {
    const log = [];
    let round = 1;

    while (true) {
      const active = animeList.filter(a => !a.eliminated && !a.qualified);
      if (active.length < 2) break;

      // Group by W-L record
      const groups = {};
      active.forEach(a => {
        const key = `${a.wins}-${a.losses}`;
        if (!groups[key]) groups[key] = [];
        groups[key].push(a);
      });

      log.push(`<h2>Round ${round}</h2>`);

      // For each group, pair and simulate matches
      for (const key in groups) {
        const group = shuffle(groups[key]);
        for (let i = 0; i < group.length; i += 2) {
          if (i + 1 >= group.length) break; // odd number, last anime waits this round

          const a1 = group[i];
          const a2 = group[i + 1];
          // Random winner
          const winner = Math.random() < 0.5 ? a1 : a2;
          const loser = winner === a1 ? a2 : a1;

          winner.wins++;
          loser.losses++;

          if (winner.wins >= 3) winner.qualified = true;
          if (loser.losses >= 3) loser.eliminated = true;

          log.push(`<div class="round">${a1.name} vs ${a2.name} ‚Üí <span class="match-winner">${winner.name}</span> gagne</div>`);
        }
      }
      round++;
    }

    // If less than 8 qualified, do playoffs between remaining active to fill slots
    let qualified = animeList.filter(a => a.qualified);
    let stillActive = animeList.filter(a => !a.eliminated && !a.qualified);
    while (qualified.length < 8 && stillActive.length > 1) {
      log.push(`<h2>Playoffs pour qualification (${qualified.length} qualifi√©s)</h2>`);
      stillActive = shuffle(stillActive);

      for (let i = 0; i < stillActive.length; i += 2) {
        if (i + 1 >= stillActive.length) break;

        const a1 = stillActive[i];
        const a2 = stillActive[i + 1];
        const winner = Math.random() < 0.5 ? a1 : a2;
        const loser = winner === a1 ? a2 : a1;

        winner.wins++;
        loser.losses++;

        if (winner.wins >= 3) winner.qualified = true;
        if (loser.losses >= 3) loser.eliminated = true;

        log.push(`<div class="round">${a1.name} vs ${a2.name} ‚Üí <span class="match-winner">${winner.name}</span> gagne</div>`);
      }

      qualified = animeList.filter(a => a.qualified);
      stillActive = animeList.filter(a => !a.eliminated && !a.qualified);
    }

    qualified = animeList.filter(a => a.qualified);

    // Sort qualified by wins desc, name asc
    qualified.sort((a,b) => b.wins - a.wins || a.name.localeCompare(b.name));

    log.push("<h2>Qualifi√©s pour le bracket √©liminatoire (Top 8)</h2>");
    log.push('<div>');
    qualified.forEach((a, i) => {
      log.push(`<span class="anime qualified">#${i + 1} ${a.name} (${a.wins}W - ${a.losses}L)</span>`);
    });
    log.push('</div>');

    return { log, qualified };
  }

  function simulateBracket(qualifiedList) {
    const log = ["<h2>Bracket √âliminatoire</h2>"];
    const match = (a, b) => (Math.random() < 0.5 ? a : b);

    // Seed 1 vs 8, 2 vs 7, etc.
    let roundAnimes = qualifiedList.slice();
    let roundNum = 1;
    while (roundAnimes.length > 1) {
      log.push(`<h3>Round ${roundNum} (${roundAnimes.length} participants)</h3>`);
      const winners = [];
      for (let i = 0; i < roundAnimes.length / 2; i++) {
        const a = roundAnimes[i];
        const b = roundAnimes[roundAnimes.length - 1 - i];
        const winner = match(a, b);
        winners.push(winner);
        log.push(`<div class="round">${a.name} vs ${b.name} ‚Üí <span class="match-winner">${winner.name}</span> gagne</div>`);
      }
      roundAnimes = winners;
      roundNum++;
    }

    log.push(`<h2>üèÜ Vainqueur du tournoi : <span class="match-winner">${roundAnimes[0].name}</span></h2>`);
    return log;
  }

  // Main execution
  const animeList = animeNames.map(name => new Anime(name));
  const swissResult = simulateSwiss(animeList);
  const bracketResult = simulateBracket(swissResult.qualified);

  const output = [...swissResult.log, ...bracketResult].join("");
  document.getElementById("output").innerHTML = output;

})();
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1v1 Championship</title>
<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1, h2 {
    margin-bottom: 20px;
  }
  #duel-container {
    display: flex;
    gap: 40px;
    max-width: 700px;
    justify-content: center;
  }
  .item {
    background: #222;
    border-radius: 10px;
    padding: 10px;
    width: 300px;
    text-align: center;
    cursor: pointer;
  }
  .item img {
    width: 100%;
    border-radius: 10px;
  }
  .item iframe {
    width: 100%;
    height: 300px;
    border-radius: 10px;
  }
  #buttons {
    margin-top: 20px;
    display: flex;
    gap: 20px;
  }
  #buttons button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
    background-color: #444;
    border: none;
    color: white;
  }
  #classement {
    margin-top: 40px;
    max-width: 700px;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
  }
  .classement-item {
    background-color: #222;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
  }
  .classement-item img {
    max-width: 160px;
    border-radius: 12px;
    user-select: none;
    pointer-events: none;
  }
  .classement-item iframe {
    width: 100%;
    height: 150px;
    border-radius: 10px;
    margin-top: 10px;
  }
  .rank {
    font-weight: bold;
    margin-bottom: 8px;
  }
</style>
</head>
<body>

<h1>1v1 Championship</h1>

<div id="duel-container"></div>
<div id="buttons"></div>
<div id="classement"></div>

<script>
(() => {
  const TOTAL_ITEMS = 16;
  const MAX_DUELS_PER_ITEM = 5;

  // Mode : 'anime' ou 'opening'
  let mode = 'anime';

  // Tes données (exemple) — Remplace par ton fetch ou tes données réelles
  const allData = {
    anime: [
      // Exemples fictifs
      {title: "Anime 1", image: "https://placehold.co/300x400?text=Anime+1"},
      {title: "Anime 2", image: "https://placehold.co/300x400?text=Anime+2"},
      {title: "Anime 3", image: "https://placehold.co/300x400?text=Anime+3"},
      {title: "Anime 4", image: "https://placehold.co/300x400?text=Anime+4"},
      {title: "Anime 5", image: "https://placehold.co/300x400?text=Anime+5"},
      {title: "Anime 6", image: "https://placehold.co/300x400?text=Anime+6"},
      {title: "Anime 7", image: "https://placehold.co/300x400?text=Anime+7"},
      {title: "Anime 8", image: "https://placehold.co/300x400?text=Anime+8"},
      {title: "Anime 9", image: "https://placehold.co/300x400?text=Anime+9"},
      {title: "Anime 10", image: "https://placehold.co/300x400?text=Anime+10"},
      {title: "Anime 11", image: "https://placehold.co/300x400?text=Anime+11"},
      {title: "Anime 12", image: "https://placehold.co/300x400?text=Anime+12"},
      {title: "Anime 13", image: "https://placehold.co/300x400?text=Anime+13"},
      {title: "Anime 14", image: "https://placehold.co/300x400?text=Anime+14"},
      {title: "Anime 15", image: "https://placehold.co/300x400?text=Anime+15"},
      {title: "Anime 16", image: "https://placehold.co/300x400?text=Anime+16"},
    ],
    opening: [
      // Exemple simplifié avec URL Youtube (youtubeUrls)
      {title: "Opening 1", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID1"]},
      {title: "Opening 2", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID2"]},
      {title: "Opening 3", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID3"]},
      {title: "Opening 4", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID4"]},
      {title: "Opening 5", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID5"]},
      {title: "Opening 6", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID6"]},
      {title: "Opening 7", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID7"]},
      {title: "Opening 8", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID8"]},
      {title: "Opening 9", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID9"]},
      {title: "Opening 10", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID10"]},
      {title: "Opening 11", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID11"]},
      {title: "Opening 12", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID12"]},
      {title: "Opening 13", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID13"]},
      {title: "Opening 14", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID14"]},
      {title: "Opening 15", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID15"]},
      {title: "Opening 16", youtubeUrls: ["https://www.youtube.com/watch?v=VIDEOID16"]},
    ]
  };

  let items = [];
  let matches = [];
  let duelCounts = [];
  let currentMatchIndex = 0;

  const duelContainer = document.getElementById('duel-container');
  const buttonsDiv = document.getElementById('buttons');
  const classementDiv = document.getElementById('classement');

  function shuffle(array) {
    for(let i = array.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  function generateMatches() {
    matches = [];
    duelCounts = new Array(TOTAL_ITEMS).fill(0);
    const pairs = [];

    for(let i = 0; i < TOTAL_ITEMS; i++){
      for(let j = i + 1; j < TOTAL_ITEMS; j++){
        pairs.push({i1: i, i2: j, winner: 0});
      }
    }
    shuffle(pairs);

    for(const pair of pairs){
      if(duelCounts[pair.i1] < MAX_DUELS_PER_ITEM && duelCounts[pair.i2] < MAX_DUELS_PER_ITEM){
        matches.push(pair);
        duelCounts[pair.i1]++;
        duelCounts[pair.i2]++;
      }
      if(duelCounts.every(c => c >= MAX_DUELS_PER_ITEM)) break;
    }
  }

  function setupUI() {
    duelContainer.innerHTML = '';
    buttonsDiv.innerHTML = '';

    // Deux conteneurs pour les items à comparer
    const div1 = document.createElement('div');
    div1.classList.add('item');
    const div2 = document.createElement('div');
    div2.classList.add('item');

    if(mode === 'anime'){
      div1.innerHTML = `<img src="" alt="" /><h3></h3>`;
      div2.innerHTML = `<img src="" alt="" /><h3></h3>`;
    } else {
      div1.innerHTML = `<iframe src="" frameborder="0" allowfullscreen></iframe><h3></h3>`;
      div2.innerHTML = `<iframe src="" frameborder="0" allowfullscreen></iframe><h3></h3>`;
    }

    duelContainer.appendChild(div1);
    duelContainer.appendChild(div2);

    // Boutons de choix
    const btn1 = document.createElement('button');
    btn1.textContent = "Choisir à gauche";
    const btn2 = document.createElement('button');
    btn2.textContent = "Choisir à droite";

    buttonsDiv.appendChild(btn1);
    buttonsDiv.appendChild(btn2);

    btn1.onclick = () => recordWin(1);
    btn2.onclick = () => recordWin(2);
    div1.onclick = () => recordWin(1);
    div2.onclick = () => recordWin(2);
  }

  function getYoutubeEmbed(url){
    try {
      const urlObj = new URL(url);
      let videoId = null;
      if(urlObj.hostname.includes('youtube.com')){
        videoId = urlObj.searchParams.get('v');
      } else if(urlObj.hostname.includes('youtu.be')){
        videoId = urlObj.pathname.substring(1);
      }
      if(videoId) return `https://www.youtube.com/embed/${videoId}?rel=0&autoplay=0`;
    } catch {}
    return null;
  }

  function showMatch() {
    if(currentMatchIndex >= matches.length){
      showClassement();
      return;
    }

    const match = matches[currentMatchIndex];
    const i1 = match.i1;
    const i2 = match.i2;

    const divs = duelContainer.children;

    if(mode === 'anime'){
      divs[0].querySelector('img').src = items[i1].image;
      divs[0].querySelector('img').alt = items[i1].title;
      divs[0].querySelector('h3').textContent = items[i1].title;

      divs[1].querySelector('img').src = items[i2].image;
      divs[1].querySelector('img').alt = items[i2].title;
      divs[1].querySelector('h3').textContent = items[i2].title;
    } else {
      const url1 = getYoutubeEmbed(items[i1].youtubeUrls[0]);
      const url2 = getYoutubeEmbed(items[i2].youtubeUrls[0]);

      divs[0].querySelector('iframe').src = url1 || '';
      divs[0].querySelector('h3').textContent = items[i1].title;

      divs[1].querySelector('iframe').src = url2 || '';
      divs[1].querySelector('h3').textContent = items[i2].title;
    }

    buttonsDiv.children[0].textContent = items[i1].title;
    buttonsDiv.children[1].textContent = items[i2].title;
  }

  function recordWin(winner) {
    matches[currentMatchIndex].winner = winner;
    currentMatchIndex++;
    showMatch();
  }

  function showClassement() {
    // On cache duel + buttons
    duelContainer.style.display = 'none';
    buttonsDiv.style.display = 'none';

    // Calcul des victoires
    const wins = new Array(TOTAL_ITEMS).fill(0);
    matches.forEach(m => {
      if(m.winner === 1) wins[m.i1]++;
      else if(m.winner === 2) wins[m.i2]++;
    });

    // On prépare les résultats, triés par victoires décroissantes
    const results = items.map((item, idx) => ({
      title: item.title,
      image: item.image || '',
      wins: wins[idx],
      youtubeUrl: item.youtubeUrls ? item.youtubeUrls[0] : null
    }));

    results.sort((a,b) => b.wins - a.wins || a.title.localeCompare(b.title));

    classementDiv.innerHTML = `<h2>Classement final (${mode === 'anime' ? 'Animes' : 'Openings'})</h2>`;

    results.forEach((r, i) => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'classement-item';

      let mediaHtml = '';
      if(mode === 'anime'){
        mediaHtml = `<img src="${r.image}" alt="${r.title}" />`;
      } else if(r.youtubeUrl){
        const embedUrl = getYoutubeEmbed(r.youtubeUrl);
        if(embedUrl) mediaHtml = `<iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
      }

      itemDiv.innerHTML = `
        <div class="rank">#${i+1} — ${r.wins} victoire${r.wins > 1 ? 's' : ''}</div>
        <div class="title">${r.title}</div>
        ${mediaHtml}
      `;
      classementDiv.appendChild(itemDiv);
    });
  }

  function start() {
    items = allData[mode].slice(0, TOTAL_ITEMS);
    generateMatches();
    setupUI();
    showMatch();
  }

  start();

})();
</script>

</body>
</html>
